---
layout: default_ds_blog
title: "Returns Based Style Analysis in R"
description: ""
Comment: "Returns Based Style Analysis in R"
date: 2019-08-25
---

<div id="wrapper">
	<div id="blog-page" class="blogcontainer">

Returns Based Style Analysis (RBSA) is a well known technique in portfolio optimisation that seeks to decompose an investment strategy (for example a mutual fund) into 
underlying 'styles' such as Large Cap Growth, Small Cap Value etc. <br><br>
Developed by Sharpe [1], this technique represents the return series of an investment strategy over \(T\) periods,
\(\{R_t, \, t = 1, \ldots, T\}\), as a linear combination of \(n\) style factors, i.e. market indices, with individual weightings, \(w_i\):

$$ \begin{align} R_t &= w_{1t} F_{1t} + w_{2t} F_{2t} + \cdots + w_{nt} F_{nt} + \varepsilon_t, \qquad \qquad t = 1, \ldots, T \qquad \qquad \mbox{[A]} \\ \\
 &= \mathbf{F_t} \cdot \mathbf{w_t} + \varepsilon_t
\end{align} 
$$

\begin{equation} R_t = w_{1t} F_{1t} + w_{2t} F_{2t} + \cdots + w_{nt} F_{nt} + \varepsilon_t, \qquad \qquad t = 1, \ldots, T \label{eq:1} 
\end{equation}
 
where \(F_{it}\) is the return on the style factor \(i\) at time \(t\) \(\eqref{eq11}\)

<br><br> 

The benefit of this approach is that unlike fundamental analysis, which relies on the (often not available) actual holdings of the strategy to determine the style/asset class weighting, RBSA only 
requires the return series of the strategy and market indices which is relatively easily available for publically traded investments via common data vendors like Bloomberg and Morningstar 

<br><br>

Sharpe proposes choosing the weights \(w_i \) that minimises the <i>variance</i> of the non-factor returns \(\varepsilon_i\). Therefore we are not seeking to minimise the distance between
the strategy return stream and the regression model [1] but rather to minimise the variance of the distance so that the two time series, R_t and model [1] look as close as possible
to two parallel lines. 

<br><br>
The constant difference between the two return streams representing the managers' constant skill/contribution to the portfolio. (It can be the case that this contribution is negative...)

<br><br>
The problem statement is therefore:
minimise ... subject to 

Constraint B describing the requirement of a long only portfolio <br>

So how do we go about using R to solve this optimisation problem? What if we try to reorganise equation [2]

So the problem can be written as [C]

by assigning the following:

Equation [C] is none other than the standard form of a <b> quadratic programming (QP) problem </b>. As luck would have it R has a QP solver in the 'quadprog' package
   
The example below 

It's a nice introduction to Non-Linear Programming (the other NLP!) as it's the simplest form of quadratic optimisation <br><br>
This post steps through a simple derivation of the quadratic function and then illustrates how to use the quadratic programming ('quadprog') package in R to do a RBSA. This toy
example uses a return stream over 10 time periods with a choice of 4 underlying indicies 

	<pre>
	<code class="r">
	#----------------
	### A Toy Example_TH
	#----------------

	install.packages("quadprog")

	library (quadprog)
	library (Matrix)

	# Fund returns matrix over T = 4 time periods
	T = 4

	e = matrix(1,T,1)
	e
	</code>
	</pre>

Define a very simple return stream here

	<pre> 
	<code class="r">
	# Specify the fund returns
	R <- matrix(c(1.5, 1.6, 1.75, 1.70))
	R

	# n = 4 Index returns over T = 4 time periods
	F1 <- c(0.76, 0.81, 0.89, 0.80)
	F2 <- c(0.93, 0.45, 0.76, 0.45)
	F3 <- c(0.15, 0.17, 0.21, 0.78)
	F4 <- c(0.20, 0.25, 0.58, 0.81)

	n = 4

	F <- cbind(F1, F2, F3, F4)
	F
	t(F)
	</code>
	</pre>

The matrix algebra occurs here

	<pre> 
	<code class="r">
	# Set up the symmetric, positive definite matrix D
	M <- diag(T) - ((e %*% t(e))/T)
	#M <- diag(T)
	class(M)
	M
	</code>
	</pre>
	
	<p> References: [1] Sharpe reference here </p>
	</div>

</div>