---
layout: default_ds_blog
title: "Hosting the WebGL Globe on a Local Web-Server With Python"
description: ""
Comment: "Hosting the WebGL Globe on a Local Web-Server With Python"
date: 2018-02-12
---

<div id="wrapper">
	<div id="blog-page" class="blogcontainer">

I recently came across <a href = "https://globe.chromeexperiments.com/">The WebGL Globe </a> released by the <a href = "https://experiments.withgoogle.com/chrome/globe"> Google Data Arts Team </a> 
and thought it would be cool to bring into some projects I was working on.
<br><br>
Heavily leveraging the Javascript <a href = "https://threejs.org/">three.js</a> 3D library, it provides 
a nice, interactive rendering of non-negative measures by geographic location.    

This post steps through how to get this up and running including how to host this visual on a simple http web-server on your local machine using Python.
<br><br>

<h3>Step 1:</h3> Have a look at Google's example showing <a href = "http://globe.chromeexperiments.com/"> global population growth </a> in the 20th century. 
To display your data in this way you will need your input data arranged in a (pretty clunky) json format as follows: <br><br>
[
<p style="text-indent: 40px">[<i> <b>'seriesA'</b>, [ "latitude_1A", "longitude_1A", "magnitude_1A", "latitude_2A", "longitude_2A", "magnitude_2A", ... ] </i></p>

<p style="text-indent: 40px">]</p>

<p style="text-indent: 40px">, [<i> <b>'seriesB'</b>, [ "latitude_1B", "longitude_1B", "magnitude_1B", "latitude_2B", "longitude_2B", "magnitude_2B", ... ] </i></p>

<p style="text-indent: 40px">] <br> <p style="text-indent: 40px">... <br> ] </p> </p>

<b>Where:</b> <br>

<ul style="list-style-type:disc;">
	<li> 1. The latitude, longitude, magnitude triples are the location/measure pairs across a number of series categories </li>
	<li> 2. The magitude values should be <= 1 </li>
	<li> 3. Each 'series' should have the same number of triples, this may require including a number of empty triples (, "", "", "") as illustrated below </li>
</ul> 


To transform data into this format will undoubtedly require some data manipulation as well as a map of latitude/longitude coordinates onto locations 
(<a href = "https://simplemaps.com/data/world-cities"> SimpleMaps </a> provides a handy reference table for this for cities). 
For example your data may more typically look like the below: <br><br>

<table align="center">
<caption><b>Table 1:</b> Sample data</caption>

  <tr>
    <th>Product Name</th>
    <th>Location</th>
    <th>Sales</th>
  </tr>
  <tr>
    <td>Product A</td>
    <td>London</td>
    <td>50</td>
  </tr>
  <tr>
    <td>Product A</td>
    <td>Sydney</td>
    <td>94</td>
  </tr>
  <tr>
    <td>Product A</td>
    <td>Melbourne</td>
    <td>34</td>
  </tr>
  <tr>
    <td>Product B</td>
    <td>Boston</td>
    <td>14</td>
  </tr>
  <tr>
    <td>Product B</td>
    <td>New York</td>
    <td>7</td>
  </tr>
</table>

<br>

In this case:
<ol style="list-style-type:disc;">
	<li> 1. The <b><i>'seriesA'</i></b>, <b><i>'seriesB'</i></b> labels in the json file would be <b><i>'Product A'</i></b> and <b><i>'Product B'</i></b> </li>
	<li> 2. You will need lat/long pairs for the cities listed </li>
	<li> 3. You will need to normalise the sales 'magitudes' to a [0,1] range. (MinMaxScaler from sklearn.preprocessing is a handy option here) </li>
	<li> 4. You will need to include a single empty triple, (, "", "", "") to the 'SeriesB' line to preserve 3 triples per Series in this case </li>
</ol>

This is described in some more detail in <b>Step 4</b> below <br><br>

<h3>Step 2:</h3> Download the 'globe' folder from the <a href = "https://github.com/dataarts/webgl-globe"> Data Arts </a> GitHub page and move <b> index.html </b>
into the folder location one level above the globe folder 
<br><br> 
The two files you will need to edit are:

<ul style="list-style-type:disc;">
	<li> 1. <b> index.html </b> which is what you will need to edit to customise the globe </li>
	<li> 2. <b> population909500.json </b> which is the input data file in json format described above </li>
</ul>

Even if you are not super familiar with html you will see places to customise your globe (e.g. line 4: Title, line 109: Copyrights. etc.) as well as the 
reference to the json input file (line 168.)<br><br>

By default <b> index.html </b> refers to the file location ~/globe/ so move <b> index.html </b> into the folder location one level above the globe folder 
<br><br>

<h3>Step 3:</h3> Get this 'out of the box' version running on your machine. If you simply double-click on the <b> index.html </b> file you will get a static web-page with no globe. 
To get the globe to resolve you can host a local web server on your machine using Python which will display the contents of the <b>index.html</b> file (i.e. the Globe) to you. 
Once you get this baseline version up and running the editing of <b>index.html</b> and the creation of your bespoke json input file are largely 
straight-forward to do.
<br><br> 
The below few lines of Python code sets up a local web-server on your machine:

<pre>
	<code class="python">
	#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
	# Filename: PythonHTTPServer.py
	# Title: Sets up a local web server
	#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
	import http.server
	import socketserver

	PORT = 8000

	Handler = http.server.SimpleHTTPRequestHandler

	httpd = socketserver.TCPServer(("", PORT), Handler)

	print ("Serving at port", PORT)
	httpd.serve_forever()
	
	#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
	# Shuts down and closes when finished
	#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
	# httpd.shutdown
	# httpd.server_close()
	</code>
</pre>

Ensure you save this .py file in the folder location <u>one level above</u> the globe folder, i.e. with <b>index.html</b>, <b>SimpleHTTPRequestHandler</b> is an HTTP request handler that serves files from the 
current directory and any of its subdirectories. Your folder should now look like the below:<br>

<img src = '/images/GlobeFolder.png'>

After running this Python code, open Chrome and navigate to <a href = "http://localhost:8000"> http://localhost:8000 </a> You should see the full interactive globe now!<br><br>

<img style = "width:100%; height: auto" src = '/images/Globe.png'>

<br><br>
By default the <b>SimpleHTTPRequestHandler</b> will be looking for a file called <b>index.html</b> in the current directory. As you're developing your version of the Globe you 
can of course rename this file to something more meaningful to you, say to <b>MyFirstGlobe.html</b>, located in the same directory, and then navigate to 
<b>http://localhost:8000/MyFirstGlobe.html</b>
<br><br>

<h3>Step 4:</h3>
Customise your version. To do this you will need to alter the <b>index.html</b> file to produce your customised <b>MyFirstGlobe.html</b> file and create a json input data file in
the globe folder, say 
<b>MyFirstGlobeJason.json</b>, that represents the data that you wish to display. There is also some small naming alignment to do to ensure you're referencing the correct json file
from your html file. For example if your data looked like 
<b>Table 1</b> above then <b>MyFirstGlobeJason.json</b> will look like the following:
<br><br>

[
<p style="text-indent: 40px">[<i> <b>'Product A'</b>, ["51.507351", "-0.127758", "0.5", "-33.868820", "151.209290", "0.94", "-37.813629", "144.963058", "0.34" ] </i></p>

<p style="text-indent: 40px">]</p>

<p style="text-indent: 40px">[<i> <b>'Product B'</b>, ["42.360081", "-71.058884", "0.14", "40.712776", "-74.005974", "0.7", "", "", "" ] </i></p>

<p style="text-indent: 40px">]</p>

]<br><br>

Note that:
<ul style="list-style-type:disc;">
	<li> 1. The latitude/longitude pairs are representative coordinates for the cities </li>
	<li> 2. The 'Product B' line has an additional, empty triple added at the end to ensure both sereies have the number of triples </li>
	<li> 3. The 'Sales' magnitudes have been normalised to a [0,1] range as below </li>
</ul> 

<table align="center">
<caption><b>Table 2:</b> Normalised Sales</caption>

  <tr>
    <th>Sales</th>
    <th>Normalised Sales</th>
  </tr>
  <tr>
    <td>50</td>
	<td>0.5</td>
  </tr>

  <tr>
    <td>94</td>
	<td>0.5</td>
  </tr>
  
   <tr>
    <td>34</td>
	<td>0.5</td>
  </tr>
  
   <tr>
    <td>14</td>
	<td>0.5</td>
  </tr>
  
  <tr>
    <td>7</td>
	<td>0.5</td>
  </tr>

</table>

<br><br>

<b>MyFirstGlobe.html</b> will have the below amendments
<pre>
	<code class="html">
	
	<div id="currentInfo">
     <span id="yearProdA" class="year">Product A</span>
	 <span id="yearProdB" class="year">Product B</span>
	</div>

	</code>
</pre>

After saving all files navigating to <b>http://localhost:8000/MyFirstGlobe.html</b> will display your customised Globe! <br><br>

<img style = "width:100%; height: auto" src = '/images/CustomGlobe.png'>

<br><br>

<h3>Step 5:</h3>
Roll out more broadly. Once you're happy with your version and want to share within your organisation you have 2 options:

<ul style="list-style-type:disc;">
	<li> 1. Send a couple of interested stakeholders a link to your locally hosted version (i.e. <b>http://localhost:8000/MyFirstGlobe.html</b>) to generate some interest 
	(this will likely result in performance issues if too many people query your machine) </li>
	<li> 2. Ask your IT department to host this on an internal, production web-server for you </li>
</ul>

	</div>
</div>